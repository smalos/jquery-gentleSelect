(function($){const defaults={minWidth:100,itemWidth:undefined,columns:undefined,rows:undefined,title:undefined,prompt:"Make A Selection",maxDisplay:0,openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",disallowEmpty:false,hideOnMouseOut:true};function defined(obj){if(typeof obj=="undefined"){return false;}
else{return true;}}
function hasError(c,o){if(defined(o.columns)&&defined(o.rows)){$.error("gentleSelect: You cannot supply both 'rows' and 'columns'");return true;}
if(defined(o.columns)&&!defined(o.itemWidth)){$.error("gentleSelect: itemWidth must be supplied if 'columns' is specified");return true;}
if(defined(o.rows)&&!defined(o.itemWidth)){$.error("gentleSelect: itemWidth must be supplied if 'rows' is specified");return true;}
if(!defined(o.openSpeed)||typeof o.openSpeed!="number"&&(typeof o.openSpeed=="string"&&(o.openSpeed!="slow"&&o.openSpeed!="fast"))){$.error("gentleSelect: openSpeed must be an integer or \"slow\" or \"fast\"");return true;}
if(!defined(o.closeSpeed)||typeof o.closeSpeed!="number"&&(typeof o.closeSpeed=="string"&&(o.closeSpeed!="slow"&&o.closeSpeed!="fast"))){$.error("gentleSelect: closeSpeed must be an integer or \"slow\" or \"fast\"");return true;}
if(!defined(o.openEffect)||(o.openEffect!="fade"&&o.openEffect!="slide")){$.error("gentleSelect: openEffect must be either 'fade' or 'slide'!");return true;}
if(!defined(o.closeEffect)||(o.closeEffect!="fade"&&o.closeEffect!="slide")){$.error("gentleSelect: closeEffect must be either 'fade' or 'slide'!");return true;}
if(!defined(o.hideOnMouseOut)||(typeof o.hideOnMouseOut!="boolean")){$.error("gentleSelect: hideOnMouseOut must be supplied and either \"true\" or \"false\"!");return true;}
return false;}
function optionOverrides(c,o){if(c.attr("multiple")){o.hideOnMouseOut=true;}}
function getSelectedAsText(elemList,opts){if(elemList.length<1){return opts.prompt;}
if(opts.maxDisplay!=0&&elemList.length>opts.maxDisplay){let arr=elemList.slice(0,opts.maxDisplay).map(function(){return $(this).text();});arr.push("...");return arr.get().join(", ");}else{let arr=elemList.map(function(){return $(this).text();});return arr.get().join(", ");}}
function updateState(c,o){const cElem=$(c);if(cElem.attr("multiple")&&o.disallowEmpty){const all_items=cElem.data("dialog").find("li"),selected_items=all_items.filter(".selected");all_items.removeClass("sole-selected");if(selected_items.length==1){selected_items.addClass("sole-selected");}}}
const methods={init:function(options){const o=$.extend({},defaults,options),select_items=this.find("option");if(hasError(this,o)){return this;}
optionOverrides(this,o);const selectElement=this;let selectTop=selectElement.css("top");let selectLeft=selectElement.css("left");const selectWidth=selectElement.outerWidth();const selectHeight=selectElement.outerHeight();const selectPosition=selectElement.css("position");if(selectTop==="auto"){selectTop=selectElement.offset().top+"px";}
if(selectLeft==="auto"){selectLeft=selectElement.offset().left+"px";}
selectElement.hide();if(this.attr("multiple")&&o.disallowEmpty){if(select_items.length==0){$.error("gentleSelect: disallowEmpty conflicts with empty <select>");}
if(this[0].selectedIndex<0){this[0].selectedIndex=0;}}
const labelText=getSelectedAsText(this.find(":selected"),o);const label=$("<span class='gentleselect-label'>"+labelText+"</span>").insertBefore(this).on("mouseenter.gentleselect",event_handlers.labelHoverIn).on("mouseleave.gentleselect",event_handlers.labelHoverOut).on("click.gentleselect",event_handlers.labelClick).data("root",this).css({position:selectPosition==="absolute"?"absolute":"relative",top:selectTop,left:selectLeft,width:selectWidth,display:"inline-block"});this.data("label",label).data("options",o);const ul=$("<ul></ul>");select_items.each(function(){const li=$("<li>"+$(this).text()+"</li>").data("value",$(this).attr("value")).data("name",$(this).text()).appendTo(ul);if($(this).attr("selected")){li.addClass("selected");}});const dialog=$("<div class='gentleselect-dialog'></div>").append(ul).insertAfter(label).bind("click.gentleselect",event_handlers.dialogClick).bind("mouseleave.gentleselect",event_handlers.dialogHoverOut).data("label",label).data("root",this);this.data("dialog",dialog);if(defined(o.columns)||defined(o.rows)){ul.css("float","left").find("li").width(o.itemWidth).css("float","left");const f=ul.find("li:first");const actualWidth=o.itemWidth
+parseInt(f.css("padding-left"))
+parseInt(f.css("padding-right"));const elemCount=ul.find("li").length;let cols,rows;if(defined(o.columns)){cols=parseInt(o.columns);rows=Math.ceil(elemCount/cols);}else{rows=parseInt(o.rows);cols=Math.ceil(elemCount/rows);}
dialog.width(actualWidth*cols);for(let i=0;i<(rows*cols)-elemCount;i++){$("<li style='float:left' class='gentleselect-dummy'><span>&nbsp;</span></li>").appendTo(ul);}
const ptr=[];let idx=0;ul.find("li").each(function(){if(idx<rows){ptr[idx]=$(this);}else{const p=idx%rows;$(this).insertAfter(ptr[p]);ptr[p]=$(this);}
idx++;});}else if(typeof o.minWidth=="number"){dialog.css("min-width",o.minWidth);}
if(defined(o.title)){$("<div class='gentleselect-title'>"+o.title+"</div>").prependTo(dialog);}
$(document).bind("keyup.gentleselect",event_handlers.keyUp);updateState(this,o);return this;},update:function(){const opts=this.data("options");const v=(this.attr("multiple")&&this.val())?this.val():[this.val()];$("li",this.data("dialog")).each(function(){const $li=$(this);const isSelected=($.inArray($li.data("value"),v)!=-1);$li.toggleClass("selected",isSelected);});const label=getSelectedAsText(this.find(":selected"),opts);this.data("label").text(label);updateState(this,opts);return this;},clear:function(){if(this.data("options").disallowEmpty){$.error("gentleSelect: cannot use 'clear' when disallowEmpty=true");return this;}
this[0].selectedIndex=-1;return methods["update"].call(this);}};const event_handlers={labelHoverIn:function(){$(this).addClass('gentleselect-label-highlight');},labelHoverOut:function(){$(this).removeClass('gentleselect-label-highlight');},labelClick:function(){const $this=$(this);const pos=$this.position();const root=$this.data("root");const opts=root.data("options");const dialog=root.data("dialog").css("top",pos.top+$this.height()).css("left",pos.left+1);if(opts.openEffect=="fade"){dialog.fadeIn(opts.openSpeed);}else{dialog.slideDown(opts.openSpeed);}},dialogHoverOut:function(){const $this=$(this);if($this.data("root").data("options").hideOnMouseOut){$this.hide();}},dialogClick:function(e){const clicked=$(e.target);const $this=$(this);const root=$this.data("root");const opts=root.data("options");if(!root.attr("multiple")){if(opts.closeEffect=="fade"){$this.fadeOut(opts.closeSpeed);}else{$this.slideUp(opts.closeSpeed);}}
if(clicked.is("li")&&!clicked.hasClass("gentleselect-dummy")){const value=clicked.data("value");const name=clicked.data("name");const label=$this.data("label");if($this.data("root").attr("multiple")){if(opts.disallowEmpty&&clicked.hasClass("selected")&&(root.find(":selected").length==1)){return;}
clicked.toggleClass("selected");const s=$this.find("li.selected");label.text(getSelectedAsText(s,opts));const v=s.map(function(){return $(this).data("value");});root.val(v.get()).trigger("change");updateState(root,opts);}else{$this.find("li.selected").removeClass("selected");clicked.addClass("selected");label.text(clicked.data("name"));root.val(value).trigger("change");}}},keyUp:function(e){if(e.keyCode==27){$(".gentleselect-dialog").hide();}}};$.fn.gentleSelect=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.gentleSelect');}};})(jQuery);
